# DUORECALL (多邻记) 产品设计文档

**日期**: 2026-01-31
**版本**: 1.0

---

## 1. 产品定位与核心架构

DUORECALL（多邻记）是一个面向深度学习的AI辅助英语句子记忆应用。产品采用多邻国风格的设计语言，以绿色为主色调，界面圆润友好，降低学习压力。应用不依赖账号登录，所有数据本地存储，支持随时导出备份。

核心架构采用Flutter跨平台开发，使用SQLite作为本地数据库持久化方案。AI服务通过调用硅基流动API实现，包括OCR识别（PaddleOCR/DeepSeek-OCR）、大语言模型处理（Qwen3-8B/DeepSeek-R1）和视觉大模型（GLM-4V）。

应用的主要使用流程是：用户批量导入多邻国截图 → 系统通过混合智能方案识别中英文句子并分类（场景、时态） → 用户选择复习方式（按场景/时态/时间） → 复习时深度学习AI解析 → 数据导出备份。

---

## 2. 图片识别与AI处理流程

图片导入采用混合智能方案以平衡成本和准确率。首先使用视觉大模型（GLM-4V-9B-Thinking）直接处理图片，提取中英文句子并进行分类。视觉模型处理速度更快，能一次性完成识别和结构化提取。仅当视觉模型调用失败或置信度低于阈值时，才降级使用OCR+LLM方案：先用OCR模型（PaddleOCR-VL-1.5或DeepSeek-OCR）提取文本，再交给大语言模型（Qwen3-8B或DeepSeek-R1-0528-Qwen3-8B）进行结构化处理。

大语言模型执行三步任务：1）从中英文混合文本中准确提取句子对（中文和对应的英文）；2）自动分类场景（如旅行、餐厅、工作等）和时态（现在时、过去时、将来时等）；3）将结构化数据保存到SQLite数据库。

时间戳采用混合优先策略：优先从图片EXIF元数据读取拍摄时间，若无则从文件名提取（如Screenshot_2025-12-13格式），最后才使用当前导入时间。这确保了按时间维度复习的准确性。

---

## 3. 复习界面与答题交互

复习界面采用垂直布局，顶部显示复习进度（当前题号/总题号）和连对题数。中部是核心答题区域，显示题目（中文或英文）和用户输入区。底部固定三个按钮：上一题、提示、确定。

答题模式默认为完整手动输入，用户在文本框中输入完整句子。点击"提示"按钮后，当前题目自动切换为点选模式，显示打散的单词列表，用户点击后单词自动移动到上方答题栏。下一题恢复为默认的完整手输模式。

提示功能的打散程度（完全打散、部分有序、分类展示）在全局设置中配置，复习界面不可调整，默认使用部分有序模式，确保适度的学习挑战性。

---

## 4. 答案评判与AI解析

点击"确定"按钮后，系统执行两层评判：首先进行字符串完全匹配，若与标准答案完全一致则立即判定正确；若不一致则调用AI模型（Qwen3-8B或DeepSeek-R1）进行语义判定，AI判定正确即为正确，否则为错误。

无论判定正确与否，都会显示标准正确答案。随后界面右下角出现AI图标，回答正确时显示"AI解读"，回答错误时显示"AI解析"。点击后从底部滑出解析抽屉，统一覆盖界面2/3，提供全屏按钮可切换覆盖整个屏幕。

AI解析针对中国人学习英语的特点，无论正确错误都进行详细解读：1）分析英文句子的结构和句子成分；2）解析时态类型和用法；3）列出使用的固定搭配和短语；4）提供相似的表达方式并配上中文翻译。如果回答错误，还会从表达习惯、欧美文化等层面解释错误原因，避免再犯类似错误，并给出记忆技巧建议。

---

## 5. 数据模型与数据库设计

SQLite数据库设计包含以下核心表：

**sentences表**：存储句子卡片数据。字段包括id（主键）、chinese_text（中文文本）、english_text（英文文本）、scene（场景分类）、tense（时态分类）、import_time（导入时间）、source_time（来源时间戳）、image_path（原始图片路径）、ocr_confidence（识别置信度）、retry_count（重试次数）、review_count（复习次数）、hint_count（提示次数）、error_count（错误次数）。

**ai_cache表**：存储AI解析缓存。字段包括id（主键）、sentence_id（关联句子）、cache_type（基础解析/追问对话）、content（解析内容）、created_at（创建时间）、is_expired（是否过期）。基础解析永久保存，追问对话7天后自动过期。

**conversation_history表**：存储追问对话历史。字段包括id（主键）、sentence_id（关联句子）、question（用户问题）、answer（AI回答）、created_at（创建时间）。

**settings表**：存储用户设置。字段包括key（设置键）、value（设置值）。包括hint_mode（提示模式：完全打散/部分有序/分类展示）、input_mode（输入模式：手输/点选）、theme（主题）、siliconflow_api_key（硅基流动API密钥，默认填充文档中的key）等配置。后期可扩展支持其他免费大模型平台（如智谱GLM）。

数据导出支持三种格式：JSON格式用于备份和迁移，CSV格式便于在Excel中查看分析，SQLite数据库文件用于完整恢复。

---

## 6. 界面设计风格与主题

应用采用多邻国风格设计语言，以明亮的绿色为主色调，营造轻松友好的学习氛围。主色使用多邻国标志性的绿色（#58CC02），辅助色包括成功绿（#58CC02）、错误红（#FF4B4B）、警告黄（#FFC800）、中性灰（#E5E5E5）。圆角设计贯穿全局，卡片和按钮采用16px-24px圆角，增强亲和力。

字体采用系统默认字体栈，标题使用粗体，正文使用常规字重。图标使用Material Icons，选择圆润风格的图标变体。卡片采用白色背景配以柔和阴影，悬浮状态时轻微上浮，提供触觉反馈。

界面遵循Material Design 3规范，但调整为更活泼的视觉风格。顶部导航栏、卡片、按钮均采用圆润设计，间距宽松（16px-32px），避免拥挤感。复习进度采用圆形进度指示器，连对题数用数字徽章显示，增强游戏化体验。

---

## 7. 详细UI设计

### 7.1 首页（HomePage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色，带柔和阴影
   - 左侧：应用Logo（多邻记图标 + 文字"多邻记"）
   - 右侧：设置图标按钮（圆形，48x48px，点击跳转到设置页面）

2. **统计卡片区域**
   - 距离顶部：16px
   - 包含3个统计卡片，横向排列，间距16px
   - **卡片1 - 卡片总数**
     - 背景色：#58CC02（绿色）
     - 圆角：16px
     - 高度：120px
     - 内容：图标（书图标，白色，32px）+ 数字（如"156"）+ 标签（"卡片总数"，白色，小字）
   - **卡片2 - 已完成复习**
     - 背景色：#FFC800（黄色）
     - 圆角：16px
     - 高度：120px
     - 内容：图标（完成图标，白色，32px）+ 数字（如"89"）+ 标签（"已完成"，白色，小字）
   - **卡片3 - 今日学习**
     - 背景色：#58CC02（绿色）
     - 圆角：16px
     - 高度：120px
     - 内容：图标（时钟图标，白色，32px）+ 数字（如"25分钟"）+ 标签（"今日学习"，白色，小字）

3. **主要功能入口区域**
   - 距离统计卡片：32px
   - 包含3个大按钮，纵向排列，间距16px
   - **按钮1 - 导入图片**
     - 高度：80px
     - 背景：白色，圆角24px
     - 左侧：图标（上传图标，绿色，40px）
     - 中间：文字"导入图片"，黑色，粗体，18px
     - 右侧：箭头图标，灰色
     - 点击效果：轻微上浮，阴影加深
     - 操作：跳转到导入图片页面
   - **按钮2 - 开始复习**
     - 高度：80px
     - 背景：#58CC02（绿色），圆角24px
     - 左侧：图标（学习图标，白色，40px）
     - 中间：文字"开始复习"，白色，粗体，18px
     - 右侧：箭头图标，白色
     - 点击效果：轻微上浮
     - 操作：跳转到复习选择页面
   - **按钮3 - 查看卡片列表**
     - 高度：80px
     - 背景：白色，圆角24px
     - 左侧：图标（列表图标，绿色，40px）
     - 中间：文字"查看卡片列表"，黑色，粗体，18px
     - 右侧：箭头图标，灰色
     - 点击效果：轻微上浮，阴影加深
     - 操作：跳转到卡片列表页面

4. **底部导航栏**
   - 高度：56px
   - 背景：白色，顶部带1px灰色分隔线
   - 包含2个导航项，均匀分布
   - **导航项1 - 首页**
     - 图标：首页图标（绿色，激活状态）
     - 文字："首页"，绿色，小字
     - 状态：激活
   - **导航项2 - 设置**
     - 图标：设置图标（灰色，非激活状态）
     - 文字："设置"，灰色，小字
     - 状态：非激活，点击跳转到设置页面

**交互说明**：
- 点击"导入图片"按钮进入导入页面
- 点击"开始复习"按钮进入复习选择页面
- 点击"查看卡片列表"按钮进入卡片列表页面
- 点击顶部设置图标或底部设置导航项进入设置页面
- 统计数据实时从数据库读取，页面打开时自动刷新

---

### 7.2 导入图片页面（ImportPage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色
   - 左侧：返回按钮（箭头图标，绿色，点击返回首页）
   - 中间：标题"导入图片"，黑色，粗体，18px
   - 右侧：帮助图标（问号，灰色，点击显示使用说明）

2. **操作按钮区域**
   - 距离顶部：16px
   - **选择图片按钮**
     - 高度：56px
     - 背景：#58CC02（绿色），圆角16px
     - 图标：相册图标，白色，24px
     - 文字："选择图片"，白色，粗体，16px
     - 操作：打开系统相册，支持多选图片

3. **已选图片列表区域**
   - 距离按钮：16px
   - 背景：白色，圆角16px，内边距16px
   - 高度：自适应，最大高度400px，超出可滚动
   - **图片项**（每项）
     - 高度：80px
     - 背景：白色，圆角12px，带轻微阴影
     - 左侧：图片缩略图（64x64px，圆角8px，显示图片内容）
     - 中间：文件名（黑色，14px，最多显示20字符，超出省略）
     - 右侧：删除按钮（X图标，红色，32x32px，点击移除该图片）
   - **空状态提示**
     - 当没有选择图片时显示
     - 图标：相册空图标，灰色，64px
     - 文字："请先选择要导入的图片"，灰色，14px

4. **识别设置区域**（可选，可折叠）
   - 距离列表：16px
   - 背景：白色，圆角16px，内边距16px
   - **设置项**
     - 标题："识别设置"，黑色，粗体，14px
     - 说明："视觉模型优先，失败时自动降级到OCR"，灰色，12px
     - 折叠/展开按钮：箭头图标

5. **开始识别按钮**
   - 距离设置：32px
   - 高度：56px
   - 背景：#58CC02（绿色），圆角16px
   - 文字："开始识别"，白色，粗体，18px
   - 状态：默认禁用（灰色），选择图片后启用（绿色）
   - 操作：开始批量识别图片

6. **识别进度区域**（识别时显示）
   - 距离按钮：16px
   - 背景：白色，圆角16px，内边距16px
   - **进度条**
     - 高度：8px
     - 背景：#E5E5E5（灰色）
     - 进度：#58CC02（绿色），宽度动态变化
   - **进度文字**
     - 文字："正在识别 3/10"，黑色，14px
   - **取消按钮**
     - 文字："取消"，灰色，14px
     - 操作：取消识别任务

7. **识别结果区域**（识别完成后显示）
   - 距离进度：16px
   - 背景：白色，圆角16px，内边距16px
   - **成功统计**
     - 文字："成功识别 8 张图片"，绿色，粗体，16px
   - **失败统计**
     - 文字："识别失败 2 张图片"，红色，14px
   - **失败图片列表**
     - 显示识别失败的图片，每项包含缩略图和重试按钮
     - 重试按钮：文字"重试"，绿色，14px
   - **保存按钮**
     - 高度：56px
     - 背景：#58CC02（绿色），圆角16px
     - 文字："保存到数据库"，白色，粗体，16px
     - 操作：将识别结果保存到数据库
   - **编辑按钮**
     - 高度：56px
     - 背景：白色，边框2px #58CC02（绿色），圆角16px
     - 文字："编辑结果"，绿色，粗体，16px
     - 操作：进入编辑页面，手动修正识别结果

**交互说明**：
- 点击"选择图片"按钮打开系统相册，支持多选
- 已选图片以列表形式显示，可单独删除
- 点击"开始识别"按钮开始批量识别
- 识别过程中显示进度，可随时取消
- 识别完成后显示成功和失败统计
- 失败的图片可单独重试
- 识别结果可编辑修正后再保存
- 识别结果采用增量保存，成功一张立即保存一张

---

### 7.3 复习选择页面（ReviewSelectionPage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色
   - 左侧：返回按钮（箭头图标，绿色，点击返回首页）
   - 中间：标题"选择复习方式"，黑色，粗体，18px
   - 右侧：无

2. **搜索框**
   - 距离顶部：16px
   - 高度：48px
   - 背景：白色，圆角12px，边框1px #E5E5E5
   - 左侧：搜索图标，灰色，20px
   - 中间：占位文字"搜索场景或时态..."，灰色，14px
   - 操作：实时过滤下方的分类列表

3. **复习方式选项卡**
   - 距离搜索框：16px
   - 高度：40px
   - 包含3个选项卡，横向排列
   - **选项卡1 - 按场景**
     - 背景：#58CC02（绿色），圆角8px
     - 文字："按场景"，白色，14px
     - 状态：激活
   - **选项卡2 - 按时态**
     - 背景：透明，圆角8px
     - 文字："按时态"，黑色，14px
     - 状态：非激活，点击切换
   - **选项卡3 - 按时间**
     - 背景：透明，圆角8px
     - 文字："按时间"，黑色，14px
     - 状态：非激活，点击切换

4. **分类列表区域**
   - 距离选项卡：16px
   - 背景：白色，圆角16px，内边距16px
   - 高度：自适应，超出可滚动
   - **分类项**（每项）
     - 高度：72px
     - 背景：白色，圆角12px，带轻微阴影
     - 左侧：图标（根据分类类型显示不同图标，40px）
       - 场景图标：餐厅、旅行、工作等
       - 时态图标：时钟图标
       - 时间图标：日历图标
     - 中间：
       - 分类名称（黑色，粗体，16px）
       - 卡片数量（绿色，12px，如"23张卡片"）
     - 右侧：箭头图标，灰色
     - 点击效果：轻微上浮，阴影加深
     - 操作：进入复习页面，加载该分类下的所有卡片
   - **空状态提示**
     - 当没有卡片时显示
     - 图标：空图标，灰色，64px
     - 文字："暂无卡片，请先导入图片"，灰色，14px
     - 按钮："去导入"，绿色，16px
     - 操作：跳转到导入图片页面

5. **底部提示**
   - 距离列表：16px
   - 背景：#E5E5E5（浅灰），圆角12px
   - 内边距：16px
   - 文字："提示：选择一个分类开始复习，复习时会记录您的学习进度"，灰色，12px

**交互说明**：
- 点击选项卡切换复习方式（按场景/按时态/按时间）
- 搜索框实时过滤分类列表
- 点击分类项进入复习页面
- 分类项显示该分类下的卡片数量
- 如果没有卡片，显示空状态提示，引导用户导入图片
- 复习方式选择灵活，可根据学习需求选择不同维度

---

### 7.4 复习页面（ReviewPage）

**布局结构（从上到下）**：

1. **顶部进度区域**
   - 高度：64px
   - 背景：白色
   - **返回按钮**
     - 位置：左上角
     - 图标：X图标，绿色，32px
     - 操作：退出复习，返回复习选择页面
   - **进度条**
     - 位置：居中
     - 宽度：200px
     - 高度：8px
     - 背景：#E5E5E5（灰色）
     - 进度：#58CC02（绿色），宽度根据当前进度动态变化
   - **进度文字**
     - 位置：进度条下方
     - 文字："3/15"，黑色，12px
   - **连对题数**
     - 位置：右上角
     - 背景：#FFC800（黄色），圆角16px
     - 文字："连对 3 题"，白色，粗体，12px
     - 图标：闪电图标，白色，16px

2. **题目类型标签**
   - 距离顶部：16px
   - 背景：#FF4B4B（红色），圆角8px
   - 内边距：4px 12px
   - 图标：哑铃图标，白色，16px
   - 文字："挑战题"（可选，仅在某些题目显示），白色，粗体，12px

3. **任务标题**
   - 距离标签：8px
   - 文字："完成翻译"（根据题目类型动态变化），黑色，粗体，16px

4. **装饰图标区域**
   - 距离标题：16px
   - 高度：80px
   - 图标：学习角色图标（多邻国风格，80x80px），居中显示
   - 目的：增加界面活泼感，降低学习压力

5. **题目显示区域**
   - 距离图标：16px
   - 背景：白色，圆角16px，内边距24px
   - **题目文字**
     - 文字：中文句子（如"她的画以什么而闻名？"），黑色，20px，粗体
     - 或英文句子（如"What's her painting famous for?"），黑色，20px，粗体
     - 对齐：居左
   - **提示虚线**（点选模式下显示）
     - 在空白处显示虚线下划线，提示用户需要填空

6. **输入区域**
   - 距离题目：16px
   - **完整输入模式**
     - 高度：56px
     - 背景：#F5F5F5（浅灰），圆角16px
     - 边框：2px solid #E5E5E5（灰色）
     - 内边距：16px
     - 占位文字："请输入答案..."，灰色，14px
     - 操作：用户手动输入完整句子
     - 自动聚焦：点击后键盘自动弹出
   - **点选模式**（点击提示后显示）
     - **答题栏**
       - 高度：56px
       - 背景：#58CC02（绿色），圆角16px
       - 内边距：16px
       - 文字：用户已选择的单词，以空格分隔，白色，16px
       - 操作：显示用户已点选的单词
     - **词库区域**
       - 距离答题栏：16px
       - 背景：白色，圆角16px，内边距16px
       - 高度：自适应
       - **单词选项**（横向排列，自动换行）
         - 每个单词为一个按钮
         - 背景：白色，圆角12px，边框2px #58CC02（绿色）
         - 内边距：8px 16px
         - 文字：单词，绿色，14px
         - 点击效果：单词移动到答题栏，按钮变为灰色（已选）
         - 操作：点击单词将其添加到答题栏
         - 再次点击已选单词可取消选择

7. **标准答案显示区域**（点击确定后显示）
   - 距离输入区域：16px
   - 背景：正确时为#58CC02（绿色），错误时为#FF4B4B（红色）
   - 圆角：16px
   - 内边距：16px
   - **判断结果**
     - 图标：正确为✓，错误为✗，白色，24px
     - 文字：正确时"正确！"，错误时"错误！"，白色，粗体，16px
   - **标准答案**
     - 文字："标准答案：What's her painting famous for?"，白色，14px
     - 对齐：居左
   - **用户答案**
     - 文字："你的答案：What's her painting famous by?"，白色，14px
     - 对齐：居左
     - 仅在错误时显示

8. **AI解析入口**（点击确定后显示）
   - 距离答案区域：16px
   - 位置：右下角
   - **AI图标按钮**
     - 背景：圆形，48x48px
     - 图标：AI图标，白色，24px
     - 文字：正确时"AI解读"，错误时"AI解析"，白色，10px
     - 点击效果：轻微上浮
     - 操作：打开AI解析抽屉

9. **底部按钮区域**
   - 距离AI解析入口：16px
   - 高度：72px
   - 背景：白色，顶部带1px灰色分隔线
   - 包含3个按钮，均匀分布
   - **按钮1 - 上一题**
     - 高度：48px
     - 背景：白色，圆角12px，边框2px #E5E5E5（灰色）
     - 图标：上一题图标，灰色，20px
     - 文字："上一题"，灰色，14px
     - 操作：返回上一题，保存当前输入状态
     - 状态：第一题时禁用（灰色）
   - **按钮2 - 提示**
     - 高度：48px
     - 背景：#FFC800（黄色），圆角12px
     - 图标：灯泡图标，白色，20px
     - 文字："提示"，白色，14px
     - 操作：切换到点选模式，显示打散的单词列表
     - 状态：点选模式下禁用（灰色）
   - **按钮3 - 确定/下一题**
     - 高度：48px
     - 背景：#58CC02（绿色），圆角12px
     - 图标：确定图标，白色，20px
     - 文字："确定"，白色，14px（点击后变为"下一题"）
     - 操作：提交答案，评判正确性
     - 点击后显示答案和AI解析入口，按钮变为"下一题"

10. **AI解析抽屉**（点击AI图标后滑出）
    - 从底部滑出，覆盖界面2/3
    - 背景：白色，圆角24px（仅顶部）
    - 内边距：24px
    - **抽屉顶部**
      - 高度：48px
      - **标题**
        - 文字：正确时"AI解读"，错误时"AI解析"，黑色，粗体，18px
        - 图标：AI图标，绿色，24px
      - **全屏按钮**
        - 图标：全屏图标，灰色，20px
        - 操作：展开到全屏
      - **关闭按钮**
        - 图标：X图标，灰色，20px
        - 操作：关闭抽屉
    - **解析内容区域**
      - 高度：自适应，超出可滚动
      - **句子结构分析**
        - 标题："句子结构"，黑色，粗体，14px
        - 内容：主语、谓语、宾语等成分分析，灰色，14px
      - **时态分析**
        - 标题："时态分析"，黑色，粗体，14px
        - 内容：时态类型和用法，灰色，14px
      - **固定搭配**
        - 标题："固定搭配"，黑色，粗体，14px
        - 内容：短语和固定搭配，灰色，14px
      - **相似表达**
        - 标题："相似表达"，黑色，粗体，14px
        - 内容：相似句子及中文翻译，灰色，14px
      - **错误分析**（仅错误时显示）
        - 标题："错误原因"，黑色，粗体，14px
        - 内容：从表达习惯、欧美文化等层面解释错误原因，灰色，14px
      - **记忆技巧**（仅错误时显示）
        - 标题："记忆技巧"，黑色，粗体，14px
        - 内容：记忆建议，灰色，14px
    - **追问输入区域**
      - 距离内容：16px
      - 高度：48px
      - 背景：#F5F5F5（浅灰），圆角12px
      - 内边距：12px
      - 占位文字："继续提问...",灰色，12px
      - 操作：用户输入问题，AI继续回答
    - **追问对话历史**（如果有）
      - 距离输入：16px
      - 背景：白色，圆角12px
      - 内边距：12px
      - 显示用户问题和AI回答的历史记录

**交互说明**：
- 默认为完整输入模式，用户手动输入答案
- 点击"提示"按钮切换到点选模式，显示打散的单词
- 点击"确定"按钮提交答案，评判正确性
- 评判后显示标准答案和AI解析入口
- 点击AI图标打开解析抽屉，查看详细解析
- 解析抽屉支持全屏展开和关闭
- 可在抽屉中继续追问，AI会继续回答
- 点击"上一题"返回上一题，保存当前输入状态
- 点击"下一题"进入下一题
- 支持手势操作：左滑返回上一题，右滑进入下一题，下滑关闭抽屉

---

### 7.5 卡片列表页面（CardListPage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色
   - 左侧：返回按钮（箭头图标，绿色，点击返回首页）
   - 中间：标题"卡片列表"，黑色，粗体，18px
   - 右侧：搜索图标（点击展开搜索框）

2. **搜索框**（默认隐藏，点击搜索图标后展开）
   - 距离顶部：8px
   - 高度：48px
   - 背景：白色，圆角12px，边框1px #E5E5E5
   - 左侧：搜索图标，灰色，20px
   - 中间：占位文字"搜索中英文...",灰色，14px
   - 右侧：关闭按钮，灰色，20px
   - 操作：实时过滤卡片列表

3. **筛选标签区域**
   - 距离搜索框：16px
   - 高度：40px
   - 包含多个筛选标签，横向排列，自动换行
   - **标签项**（每项）
     - 背景：#E5E5E5（灰色），圆角8px
     - 内边距：4px 12px
     - 文字：场景或时态名称，黑色，12px
     - 数量：如"旅行(23)"，灰色，10px
     - 点击效果：激活时背景变为#58CC02（绿色），文字变为白色
     - 操作：点击标签筛选对应的卡片
   - **全部标签**
     - 背景：#58CC02（绿色），圆角8px
     - 文字："全部"，白色，12px
     - 数量：如"全部(156)"，白色，10px
     - 状态：默认激活

4. **排序选项**
   - 距离标签：8px
   - 高度：32px
   - **排序文字**
     - 文字："排序：导入时间 ↓"，灰色，12px
   - **排序按钮**
     - 图标：排序图标，灰色，16px
     - 操作：弹出排序选项（导入时间/复习次数/错误次数）

5. **卡片列表区域**
   - 距离排序：16px
   - 背景：白色，圆角16px，内边距16px
   - 高度：自适应，超出可滚动
   - **卡片项**（每项）
     - 高度：120px
     - 背景：白色，圆角12px，带轻微阴影
     - 左侧：
       - 装饰图标（根据场景显示不同图标，48px）
         - 场景图标：餐厅、旅行、工作等
         - 时态图标：时钟图标
     - 中间：
       - **中文文本**
         - 文字：中文句子预览，最多显示30字符，超出省略，黑色，14px
       - **英文文本**
         - 文字：英文句子预览，最多显示30字符，超出省略，黑色，14px
       - **标签区域**
         - 距离文本：8px
         - 包含3个标签，横向排列
         - **场景标签**
           - 背景：#E5E5E5（灰色），圆角4px
           - 内边距：2px 8px
           - 文字：场景名称，黑色，10px
         - **时态标签**
           - 背景：#E5E5E5（灰色），圆角4px
           - 内边距：2px 8px
           - 文字：时态名称，黑色，10px
         - **复习次数标签**
           - 背景：#58CC02（绿色），圆角4px
           - 内边距：2px 8px
           - 文字："复习3次"，白色，10px
     - 右侧：
       - 箭头图标，灰色，20px
     - 点击效果：轻微上浮，阴影加深
     - 操作：进入卡片详情页面
   - **空状态提示**
     - 当没有卡片时显示
     - 图标：空图标，灰色，64px
     - 文字："暂无卡片，请先导入图片"，灰色，14px
     - 按钮："去导入"，绿色，16px
     - 操作：跳转到导入图片页面

6. **底部加载提示**（滚动到底部时显示）
   - 距离列表：16px
   - 文字："正在加载更多..."，灰色，12px
   - 图标：加载动画，灰色，16px

**交互说明**：
- 点击搜索图标展开搜索框，实时过滤卡片
- 点击筛选标签按场景或时态筛选卡片
- 点击排序按钮选择排序方式
- 点击卡片项进入卡片详情页面，查看完整信息和编辑
- 卡片列表分页加载，滚动到底部自动加载下一页
- 每页显示20条记录
- 如果没有卡片，显示空状态提示，引导用户导入图片

---

### 7.6 卡片详情页面（CardDetailPage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色
   - 左侧：返回按钮（箭头图标，绿色，点击返回卡片列表）
   - 中间：标题"卡片详情"，黑色，粗体，18px
   - 右侧：
     - 编辑按钮（编辑图标，绿色，点击进入编辑模式）
     - 删除按钮（删除图标，红色，点击删除卡片）

2. **卡片信息区域**
   - 距离顶部：16px
   - 背景：白色，圆角16px，内边距24px
   - **装饰图标**
     - 图标：场景图标，64px
     - 位置：顶部居中
   - **中文文本**
     - 距离图标：16px
     - 标题："中文"，黑色，粗体，14px
     - 文本：中文句子，黑色，16px
     - 操作：编辑模式下可修改
   - **英文文本**
     - 距离中文：16px
     - 标题："英文"，黑色，粗体，14px
     - 文本：英文句子，黑色，16px
     - 操作：编辑模式下可修改
   - **场景标签**
     - 距离英文：16px
     - 标题："场景"，黑色，粗体，14px
     - 标签：场景名称，#58CC02（绿色），圆角8px，内边距4px 12px
     - 操作：编辑模式下可修改
   - **时态标签**
     - 距离场景：8px
     - 标题："时态"，黑色，粗体，14px
     - 标签：时态名称，#58CC02（绿色），圆角8px，内边距4px 12px
     - 操作：编辑模式下可修改
   - **导入时间**
     - 距离时态：16px
     - 标题："导入时间"，黑色，粗体，14px
     - 文本：2025-12-13 09:28，灰色，14px
   - **来源时间**
     - 距离导入：8px
     - 标题："来源时间"，黑色，粗体，14px
     - 文本：2025-12-13 09:28（从图片EXIF或文件名提取），灰色，14px
   - **统计信息**
     - 距离来源：16px
     - 包含3个统计项，横向排列
     - **复习次数**
       - 文字："复习 3 次"，灰色，14px
     - **提示次数**
       - 文字："提示 1 次"，灰色，14px
     - **错误次数**
       - 文字："错误 2 次"，灰色，14px

3. **原始图片区域**
   - 距离信息：16px
   - 背景：白色，圆角16px，内边距16px
   - **图片标题**
     - 文字："原始图片"，黑色，粗体，14px
   - **图片预览**
     - 图片：原始截图，圆角12px
     - 宽度：100%
     - 操作：点击放大查看
   - **图片信息**
     - 距离图片：8px
     - 文字：文件名和文件大小，灰色，12px

4. **AI解析历史区域**
   - 距离图片：16px
   - 背景：白色，圆角16px，内边距16px
   - **标题**
     - 文字："AI解析历史"，黑色，粗体，14px
   - **解析记录列表**
     - **解析记录项**（每项）
       - 距离上一项：8px
       - 背景：#F5F5F5（浅灰），圆角8px，内边距12px
       - **时间**
         - 文字：2025-12-13 09:30，灰色，10px
       - **类型**
         - 文字：基础解析 / 追问，黑色，10px
       - **内容预览**
         - 文字：解析内容预览，最多显示50字符，超出省略，灰色，12px
       - 操作：点击查看完整解析
   - **空状态提示**
     - 当没有解析记录时显示
     - 文字："暂无解析记录"，灰色，12px

5. **底部操作区域**
   - 距离解析：16px
   - 包含2个按钮，纵向排列，间距16px
   - **按钮1 - 开始复习这张卡片**
     - 高度：56px
     - 背景：#58CC02（绿色），圆角16px
     - 图标：学习图标，白色，24px
     - 文字："开始复习这张卡片"，白色，粗体，16px
     - 操作：进入复习页面，只复习这一张卡片
   - **按钮2 - 查看相似卡片**
     - 高度：56px
     - 背景：白色，边框2px #58CC02（绿色），圆角16px
     - 图标：相似图标，绿色，24px
     - 文字："查看相似卡片"，绿色，粗体，16px
     - 操作：筛选显示相似的卡片（相同场景或时态）

**交互说明**：
- 查看模式：只能查看卡片信息，不能修改
- 编辑模式：可以修改中文、英文、场景、时态等字段
- 点击编辑按钮进入编辑模式
- 点击删除按钮弹出确认对话框，确认后删除卡片
- 点击原始图片放大查看
- 点击解析记录查看完整解析内容
- 点击"开始复习这张卡片"进入复习页面
- 点击"查看相似卡片"筛选相似卡片

---

### 7.7 设置页面（SettingsPage）

**布局结构（从上到下）**：

1. **顶部导航栏**
   - 高度：64px
   - 背景：白色
   - 左侧：返回按钮（箭头图标，绿色，点击返回首页）
   - 中间：标题"设置"，黑色，粗体，18px
   - 右侧：无

2. **设置分组区域**
   - 距离顶部：16px
   - 包含多个设置分组，纵向排列

   **分组1 - API设置**
   - 距离顶部：16px
   - 背景：白色，圆角16px，内边距16px
   - **分组标题**
     - 文字："API设置"，黑色，粗体，14px
   - **设置项 - 硅基流动API密钥**
     - 距离标题：16px
     - **标签**
       - 文字："硅基流动API密钥"，黑色，14px
     - **输入框**
       - 距离标签：8px
       - 高度：48px
       - 背景：#F5F5F5（浅灰），圆角12px
       - 内边距：12px
       - 文字：默认密钥（sk-wmewhcwoftsdmnyzhzxutcsfgthpfcboogdfutrlrchaaayi），黑色，14px
       - 操作：用户可修改密钥
     - **说明**
       - 距离输入框：8px
       - 文字："用于调用AI识别和解析服务，请勿泄露给他人",灰色，10px

   **分组2 - 提示设置**
   - 距离上一分组：16px
   - 背景：白色，圆角16px，内边距16px
   - **分组标题**
     - 文字："提示设置"，黑色，粗体，14px
   - **设置项 - 提示模式**
     - 距离标题：16px
     - **标签**
       - 文字："提示模式",黑色，14px
     - **选项**
       - 距离标签：8px
       - 包含3个单选按钮，纵向排列
       - **选项1 - 完全打散**
         - 图标：单选图标，激活时为绿色
         - 文字："完全打散 - 所有词完全随机打乱"，黑色，12px
       - **选项2 - 部分有序**（默认选中）
         - 图标：单选图标，激活时为绿色
         - 文字："部分有序 - 保持一定语义顺序"，黑色，12px
       - **选项3 - 分类展示**
         - 图标：单选图标，激活时为绿色
         - 文字："分类展示 - 按词性分组显示"，黑色，12px

   **分组3 - 数据管理**
   - 距离上一分组：16px
   - 背景：白色，圆角16px，内边距16px
   - **分组标题**
     - 文字："数据管理"，黑色，粗体，14px
   - **设置项 - 导出数据**
     - 距离标题：16px
     - **标签**
       - 文字："导出数据"，黑色，14px
     - **格式选择**
       - 距离标签：8px
       - 包含3个按钮，横向排列，间距8px
       - **按钮1 - JSON**
         - 背景：#58CC02（绿色），圆角8px
         - 文字："JSON"，白色，12px
         - 操作：导出为JSON格式
       - **按钮2 - CSV**
         - 背景：白色，边框2px #58CC02（绿色），圆角8px
         - 文字："CSV"，绿色，12px
         - 操作：导出为CSV格式
       - **按钮3 - SQLite**
         - 背景：白色，边框2px #58CC02（绿色），圆角8px
         - 文字："SQLite"，绿色，12px
         - 操作：导出为SQLite数据库文件
   - **设置项 - 导入数据**
     - 距离导出：16px
     - **标签**
       - 文字："导入数据"，黑色，14px
     - **按钮**
       - 距离标签：8px
       - 高度：48px
       - 背景：白色，边框2px #58CC02（绿色），圆角12px
       - 文字："选择文件导入"，绿色，14px
       - 操作：选择文件导入数据

   **分组4 - 应用信息**
   - 距离上一分组：16px
   - 背景：白色，圆角16px，内边距16px
   - **分组标题**
     - 文字："应用信息"，黑色，粗体，14px
   - **设置项 - 版本信息**
     - 距离标题：16px
     - 文字："版本：1.0.0"，灰色，12px
   - **设置项 - 卡片统计**
     - 距离版本：8px
     - 文字："卡片总数：156 张"，灰色，12px
   - **设置项 - 存储空间**
     - 距离统计：8px
     - 文字："存储空间：12.5 MB",灰色，12px

3. **底部按钮区域**
   - 距离分组：32px
   - **按钮 - 清除所有数据**
     - 高度：56px
     - 背景：#FF4B4B（红色），圆角16px
     - 图标：清除图标，白色，24px
     - 文字："清除所有数据",白色，粗体，16px
     - 操作：弹出确认对话框，确认后清除所有数据

**交互说明**：
- 修改API密钥后自动保存
- 点击提示模式单选按钮切换提示模式
- 点击导出格式按钮导出对应格式的数据
- 点击导入按钮选择文件导入数据
- 清除数据需要二次确认
- 所有设置实时生效

---

## 8. 核心页面结构概述

应用包含以下核心页面：

**首页**：显示统计概览和快捷入口。顶部显示卡片总数、已完成复习数、今日学习时间。中部提供三个主要入口：导入图片、开始复习、查看卡片列表。底部导航栏切换到设置页面。

**导入页面**：支持批量选择图片文件。显示已选择的图片预览列表，每张图片显示缩略图和文件名。点击"开始识别"按钮后，显示识别进度，识别完成后显示成功和失败的统计，失败的图片可单独重试。识别结果可编辑修正后再保存到数据库。

**复习选择页面**：提供多种复习筛选方式。按场景复习（如旅行、餐厅、工作等）、按时态复习（现在时、过去时、将来时等）、按时间复习（今天、本周、本月等）。每个分类显示该分类下的卡片数量，点击后进入复习界面。

**复习页面**：核心答题界面，顶部显示进度和连对数，中部显示题目和输入区，配以活泼的图标装饰，底部固定三个按钮（上一题、提示、确定）。答题后显示AI图标，点击查看解析。

**卡片列表页面**：显示所有导入的句子卡片，支持搜索和筛选。每张卡片配以图标装饰，显示中英文预览、场景、时态、复习次数等标签。点击卡片可查看详情和编辑。

**卡片详情页面**：查看单张卡片的详细信息，包括中英文、场景、时态、导入时间、原始图片、AI解析历史等。支持编辑和删除操作。

**设置页面**：配置API密钥、提示模式、主题等设置项。提供数据导出和导入功能，支持JSON、CSV、SQLite三种格式。

**导入页面**：支持批量选择图片文件。显示已选择的图片预览列表，每张图片显示缩略图和文件名。点击"开始识别"按钮后，显示识别进度，识别完成后显示成功和失败的统计，失败的图片可单独重试。识别结果可编辑修正后再保存到数据库。

**复习选择页面**：提供多种复习筛选方式。按场景复习（如旅行、餐厅、工作等）、按时态复习（现在时、过去时、将来时等）、按时间复习（今天、本周、本月等）。每个分类显示该分类下的卡片数量，点击后进入复习界面。

**复习页面**：核心答题界面，顶部显示进度和连对数，中部显示题目和输入区，配以活泼的图标装饰，底部固定三个按钮（上一题、提示、确定）。答题后显示AI图标，点击查看解析。

**卡片列表页面**：显示所有导入的句子卡片，支持搜索和筛选。每张卡片配以图标装饰，显示中英文预览、场景、时态、复习次数等标签。点击卡片可查看详情和编辑。

**设置页面**：配置API密钥、提示模式、主题等设置项。提供数据导出和导入功能，支持JSON、CSV、SQLite三种格式。

---

## 8. 错误处理与边界情况

AI服务调用失败处理：视觉模型调用失败时自动降级到OCR+LLM方案，OCR失败则提示用户手动输入或重试。大语言模型调用失败时，先检查网络连接，若网络正常则重试最多3次，仍失败则显示友好的错误提示，建议用户检查API密钥或稍后重试。

图片识别边界情况：图片质量过低导致识别失败时，标记为待处理状态，允许用户手动编辑中英文内容和分类。图片无法读取（格式不支持、文件损坏）时，显示错误提示并跳过该图片。识别置信度低于60%时，标记为需要人工确认，在导入结果页面高亮显示。

复习界面边界情况：用户输入为空时点击确定，提示"请输入答案"。用户点击上一题时，保存当前输入状态，返回时可恢复输入。AI解析加载超时（超过10秒）时，显示加载提示，用户可选择继续等待或取消。追问对话时，若AI回答过长，自动截断显示并提供"展开全部"按钮。

数据导出导入边界情况：导出时若存储空间不足，提示用户清理空间后重试。导入数据格式错误时，显示具体错误信息，支持部分导入。导入数据与现有数据冲突时，提示用户选择覆盖或跳过。

---

## 9. 性能优化与用户体验

图片批量导入优化：支持后台队列处理，用户可以在识别过程中继续浏览其他页面。导入进度实时显示，支持取消操作。识别结果采用增量保存，成功一张立即保存一张，避免一次性处理失败导致数据丢失。

AI解析加载优化：解析内容采用预加载策略，用户进入复习页面时预先加载前3题的AI解析缓存。解析抽屉使用懒加载，点击后才渲染内容。长文本内容使用虚拟滚动，避免一次性渲染大量DOM节点。

数据库查询优化：卡片列表分页加载，每页显示20条，滚动到底部自动加载下一页。常用查询（按场景、时态筛选）建立索引，提升查询速度。统计信息缓存，避免每次打开首页都重新计算。

用户体验细节：答题输入框支持自动聚焦，点击输入区域后键盘自动弹出。词库点选模式下，已选中的单词高亮显示，支持点击已选单词取消选择。复习页面支持手势操作，左滑返回上一题，右滑进入下一题。AI解析抽屉支持手势下滑关闭。

启动优化：应用启动时显示加载动画，后台预加载必要的资源和配置。首页数据异步加载，优先显示静态界面，数据加载完成后平滑更新。

---

## 10. 技术栈与依赖包

Flutter核心依赖：使用Flutter SDK 3.10.7及以上版本，确保跨平台兼容性。UI组件使用Material Design 3，配合cupertino_icons支持iOS风格图标。

本地数据库：使用sqflite包（版本2.3.0+）提供SQLite数据库支持，path_provider包（版本2.1.0+）获取应用存储路径。

HTTP请求：使用http包（版本1.1.0+）调用硅基流动API，dio包（版本5.3.0+）处理高级网络请求（拦截器、重试、超时控制）。

图片处理：使用image_picker包（版本1.0.0+）选择图片文件，image包（版本4.0.0+）处理图片压缩和缩略图生成，exif包（版本3.1.0+）读取图片EXIF元数据提取时间戳。

状态管理：使用provider包（版本6.0.0+）进行轻量级状态管理，rxdart包（版本0.27.0+）处理响应式数据流。

工具库：intl包（版本0.18.0+）处理日期格式化，shared_preferences包（版本2.2.0+）存储简单配置，url_launcher包（版本6.1.0+）打开外部链接。

测试依赖：使用flutter_test进行单元测试和widget测试，mockito包（版本5.4.0+）模拟依赖项。

代码质量：使用flutter_lints进行静态代码检查，代码格式遵循Dart官方规范。

---

## 11. AI服务配置

硅基流动API密钥：`sk-wmewhcwoftsdmnyzhzxutcsfgthpfcboogdfutrlrchaaayi`

API文档地址：https://docs.siliconflow.cn/cn/api-reference/chat-completions/chat-completions

可用模型：
- 视觉大模型：THUDM/GLM-4.1V-9B-Thinking
- OCR模型：PaddlePaddle/PaddleOCR-VL-1.5, deepseek-ai/DeepSeek-OCR
- 大语言模型：Qwen/Qwen3-8B, deepseek-ai/DeepSeek-R1-0528-Qwen3-8B

---

## 12. 设计总结

DUORECALL是一款针对中国人学习英语的深度学习应用，通过AI辅助实现智能识别、分类和解析。产品强调深度学习而非快速刷题，通过详细的AI解析帮助用户理解英语句子的结构、时态、固定搭配和文化背景，从表达习惯层面避免常见错误。

产品采用多邻国风格设计，界面友好活泼，降低学习压力。支持灵活的答题模式（完整输入/词库点选）和智能提示（可调节难度）。数据完全本地存储，支持多种格式导出备份，保护用户隐私。

通过混合智能方案平衡成本和准确率，优先使用视觉大模型，失败时降级到OCR+LLM方案。AI解析采用智能缓存策略，基础解析永久保存，追问对话7天过期，兼顾成本和功能。