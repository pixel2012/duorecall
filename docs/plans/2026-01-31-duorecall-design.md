# DUORECALL (多邻记) 产品设计文档

**日期**: 2026-01-31
**版本**: 1.0

---

## 1. 产品定位与核心架构

DUORECALL（多邻记）是一个面向深度学习的AI辅助英语句子记忆应用。产品采用多邻国风格的设计语言，以绿色为主色调，界面圆润友好，降低学习压力。应用不依赖账号登录，所有数据本地存储，支持随时导出备份。

核心架构采用Flutter跨平台开发，使用SQLite作为本地数据库持久化方案。AI服务通过调用硅基流动API实现，包括OCR识别（PaddleOCR/DeepSeek-OCR）、大语言模型处理（Qwen3-8B/DeepSeek-R1）和视觉大模型（GLM-4V）。

应用的主要使用流程是：用户批量导入多邻国截图 → 系统通过混合智能方案识别中英文句子并分类（场景、时态） → 用户选择复习方式（按场景/时态/时间） → 复习时深度学习AI解析 → 数据导出备份。

---

## 2. 图片识别与AI处理流程

图片导入采用混合智能方案以平衡成本和准确率。首先使用视觉大模型（GLM-4V-9B-Thinking）直接处理图片，提取中英文句子并进行分类。视觉模型处理速度更快，能一次性完成识别和结构化提取。仅当视觉模型调用失败或置信度低于阈值时，才降级使用OCR+LLM方案：先用OCR模型（PaddleOCR-VL-1.5或DeepSeek-OCR）提取文本，再交给大语言模型（Qwen3-8B或DeepSeek-R1-0528-Qwen3-8B）进行结构化处理。

大语言模型执行三步任务：1）从中英文混合文本中准确提取句子对（中文和对应的英文）；2）自动分类场景（如旅行、餐厅、工作等）和时态（现在时、过去时、将来时等）；3）将结构化数据保存到SQLite数据库。

时间戳采用混合优先策略：优先从图片EXIF元数据读取拍摄时间，若无则从文件名提取（如Screenshot_2025-12-13格式），最后才使用当前导入时间。这确保了按时间维度复习的准确性。

---

## 3. 复习界面与答题交互

复习界面采用垂直布局，顶部显示复习进度（当前题号/总题号）和连对题数。中部是核心答题区域，显示题目（中文或英文）和用户输入区。底部固定三个按钮：上一题、提示、确定。

答题模式默认为完整手动输入，用户在文本框中输入完整句子。点击"提示"按钮后，当前题目自动切换为点选模式，显示打散的单词列表，用户点击后单词自动移动到上方答题栏。下一题恢复为默认的完整手输模式。

提示功能的打散程度（完全打散、部分有序、分类展示）在全局设置中配置，复习界面不可调整，默认使用部分有序模式，确保适度的学习挑战性。

---

## 4. 答案评判与AI解析

点击"确定"按钮后，系统执行两层评判：首先进行字符串完全匹配，若与标准答案完全一致则立即判定正确；若不一致则调用AI模型（Qwen3-8B或DeepSeek-R1）进行语义判定，AI判定正确即为正确，否则为错误。

无论判定正确与否，都会显示标准正确答案。随后界面右下角出现AI图标，回答正确时显示"AI解读"，回答错误时显示"AI解析"。点击后从底部滑出解析抽屉，统一覆盖界面2/3，提供全屏按钮可切换覆盖整个屏幕。

AI解析针对中国人学习英语的特点，无论正确错误都进行详细解读：1）分析英文句子的结构和句子成分；2）解析时态类型和用法；3）列出使用的固定搭配和短语；4）提供相似的表达方式并配上中文翻译。如果回答错误，还会从表达习惯、欧美文化等层面解释错误原因，避免再犯类似错误，并给出记忆技巧建议。

---

## 5. 数据模型与数据库设计

SQLite数据库设计包含以下核心表：

**sentences表**：存储句子卡片数据。字段包括id（主键）、chinese_text（中文文本）、english_text（英文文本）、scene（场景分类）、tense（时态分类）、import_time（导入时间）、source_time（来源时间戳）、image_path（原始图片路径）、ocr_confidence（识别置信度）、retry_count（重试次数）、review_count（复习次数）、hint_count（提示次数）、error_count（错误次数）。

**ai_cache表**：存储AI解析缓存。字段包括id（主键）、sentence_id（关联句子）、cache_type（基础解析/追问对话）、content（解析内容）、created_at（创建时间）、is_expired（是否过期）。基础解析永久保存，追问对话7天后自动过期。

**conversation_history表**：存储追问对话历史。字段包括id（主键）、sentence_id（关联句子）、question（用户问题）、answer（AI回答）、created_at（创建时间）。

**settings表**：存储用户设置。字段包括key（设置键）、value（设置值）。包括hint_mode（提示模式：完全打散/部分有序/分类展示）、input_mode（输入模式：手输/点选）、theme（主题）、siliconflow_api_key（硅基流动API密钥，默认填充文档中的key）等配置。后期可扩展支持其他免费大模型平台（如智谱GLM）。

数据导出支持三种格式：JSON格式用于备份和迁移，CSV格式便于在Excel中查看分析，SQLite数据库文件用于完整恢复。

---

## 6. 界面设计风格与主题

应用采用多邻国风格设计语言，以明亮的绿色为主色调，营造轻松友好的学习氛围。主色使用多邻国标志性的绿色（#58CC02），辅助色包括成功绿（#58CC02）、错误红（#FF4B4B）、警告黄（#FFC800）、中性灰（#E5E5E5）。圆角设计贯穿全局，卡片和按钮采用16px-24px圆角，增强亲和力。

字体采用系统默认字体栈，标题使用粗体，正文使用常规字重。图标使用Material Icons，选择圆润风格的图标变体。卡片采用白色背景配以柔和阴影，悬浮状态时轻微上浮，提供触觉反馈。

界面遵循Material Design 3规范，但调整为更活泼的视觉风格。顶部导航栏、卡片、按钮均采用圆润设计，间距宽松（16px-32px），避免拥挤感。复习进度采用圆形进度指示器，连对题数用数字徽章显示，增强游戏化体验。

---

## 7. 核心页面结构

应用包含以下核心页面：

**首页**：显示统计概览和快捷入口。顶部显示卡片总数、已完成复习数、今日学习时间。中部提供三个主要入口：导入图片、开始复习、查看卡片列表。底部导航栏切换到设置页面。

**导入页面**：支持批量选择图片文件。显示已选择的图片预览列表，每张图片显示缩略图和文件名。点击"开始识别"按钮后，显示识别进度，识别完成后显示成功和失败的统计，失败的图片可单独重试。识别结果可编辑修正后再保存到数据库。

**复习选择页面**：提供多种复习筛选方式。按场景复习（如旅行、餐厅、工作等）、按时态复习（现在时、过去时、将来时等）、按时间复习（今天、本周、本月等）。每个分类显示该分类下的卡片数量，点击后进入复习界面。

**复习页面**：核心答题界面，顶部显示进度和连对数，中部显示题目和输入区，配以活泼的图标装饰，底部固定三个按钮（上一题、提示、确定）。答题后显示AI图标，点击查看解析。

**卡片列表页面**：显示所有导入的句子卡片，支持搜索和筛选。每张卡片配以图标装饰，显示中英文预览、场景、时态、复习次数等标签。点击卡片可查看详情和编辑。

**设置页面**：配置API密钥、提示模式、主题等设置项。提供数据导出和导入功能，支持JSON、CSV、SQLite三种格式。

---

## 8. 错误处理与边界情况

AI服务调用失败处理：视觉模型调用失败时自动降级到OCR+LLM方案，OCR失败则提示用户手动输入或重试。大语言模型调用失败时，先检查网络连接，若网络正常则重试最多3次，仍失败则显示友好的错误提示，建议用户检查API密钥或稍后重试。

图片识别边界情况：图片质量过低导致识别失败时，标记为待处理状态，允许用户手动编辑中英文内容和分类。图片无法读取（格式不支持、文件损坏）时，显示错误提示并跳过该图片。识别置信度低于60%时，标记为需要人工确认，在导入结果页面高亮显示。

复习界面边界情况：用户输入为空时点击确定，提示"请输入答案"。用户点击上一题时，保存当前输入状态，返回时可恢复输入。AI解析加载超时（超过10秒）时，显示加载提示，用户可选择继续等待或取消。追问对话时，若AI回答过长，自动截断显示并提供"展开全部"按钮。

数据导出导入边界情况：导出时若存储空间不足，提示用户清理空间后重试。导入数据格式错误时，显示具体错误信息，支持部分导入。导入数据与现有数据冲突时，提示用户选择覆盖或跳过。

---

## 9. 性能优化与用户体验

图片批量导入优化：支持后台队列处理，用户可以在识别过程中继续浏览其他页面。导入进度实时显示，支持取消操作。识别结果采用增量保存，成功一张立即保存一张，避免一次性处理失败导致数据丢失。

AI解析加载优化：解析内容采用预加载策略，用户进入复习页面时预先加载前3题的AI解析缓存。解析抽屉使用懒加载，点击后才渲染内容。长文本内容使用虚拟滚动，避免一次性渲染大量DOM节点。

数据库查询优化：卡片列表分页加载，每页显示20条，滚动到底部自动加载下一页。常用查询（按场景、时态筛选）建立索引，提升查询速度。统计信息缓存，避免每次打开首页都重新计算。

用户体验细节：答题输入框支持自动聚焦，点击输入区域后键盘自动弹出。词库点选模式下，已选中的单词高亮显示，支持点击已选单词取消选择。复习页面支持手势操作，左滑返回上一题，右滑进入下一题。AI解析抽屉支持手势下滑关闭。

启动优化：应用启动时显示加载动画，后台预加载必要的资源和配置。首页数据异步加载，优先显示静态界面，数据加载完成后平滑更新。

---

## 10. 技术栈与依赖包

Flutter核心依赖：使用Flutter SDK 3.10.7及以上版本，确保跨平台兼容性。UI组件使用Material Design 3，配合cupertino_icons支持iOS风格图标。

本地数据库：使用sqflite包（版本2.3.0+）提供SQLite数据库支持，path_provider包（版本2.1.0+）获取应用存储路径。

HTTP请求：使用http包（版本1.1.0+）调用硅基流动API，dio包（版本5.3.0+）处理高级网络请求（拦截器、重试、超时控制）。

图片处理：使用image_picker包（版本1.0.0+）选择图片文件，image包（版本4.0.0+）处理图片压缩和缩略图生成，exif包（版本3.1.0+）读取图片EXIF元数据提取时间戳。

状态管理：使用provider包（版本6.0.0+）进行轻量级状态管理，rxdart包（版本0.27.0+）处理响应式数据流。

工具库：intl包（版本0.18.0+）处理日期格式化，shared_preferences包（版本2.2.0+）存储简单配置，url_launcher包（版本6.1.0+）打开外部链接。

测试依赖：使用flutter_test进行单元测试和widget测试，mockito包（版本5.4.0+）模拟依赖项。

代码质量：使用flutter_lints进行静态代码检查，代码格式遵循Dart官方规范。

---

## 11. AI服务配置

硅基流动API密钥：`sk-wmewhcwoftsdmnyzhzxutcsfgthpfcboogdfutrlrchaaayi`

API文档地址：https://docs.siliconflow.cn/cn/api-reference/chat-completions/chat-completions

可用模型：
- 视觉大模型：THUDM/GLM-4.1V-9B-Thinking
- OCR模型：PaddlePaddle/PaddleOCR-VL-1.5, deepseek-ai/DeepSeek-OCR
- 大语言模型：Qwen/Qwen3-8B, deepseek-ai/DeepSeek-R1-0528-Qwen3-8B

---

## 12. 设计总结

DUORECALL是一款针对中国人学习英语的深度学习应用，通过AI辅助实现智能识别、分类和解析。产品强调深度学习而非快速刷题，通过详细的AI解析帮助用户理解英语句子的结构、时态、固定搭配和文化背景，从表达习惯层面避免常见错误。

产品采用多邻国风格设计，界面友好活泼，降低学习压力。支持灵活的答题模式（完整输入/词库点选）和智能提示（可调节难度）。数据完全本地存储，支持多种格式导出备份，保护用户隐私。

通过混合智能方案平衡成本和准确率，优先使用视觉大模型，失败时降级到OCR+LLM方案。AI解析采用智能缓存策略，基础解析永久保存，追问对话7天过期，兼顾成本和功能。